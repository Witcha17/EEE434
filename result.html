<script>
    // 1. ดึงข้อมูล
    let allData = JSON.parse(localStorage.getItem('eee434_responses')) || [];

    // 2. เรียงลำดับตามเวลา (น้อยไปมาก = ส่งก่อนขึ้นก่อน)
    allData.sort((a, b) => a.time - b.time);

    const tbody = document.getElementById('tableBody');

    // 3. วนลูปสร้างแถวตาราง
    if (allData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 40px; color:#999;">ยังไม่มีการส่งคำตอบ</td></tr>';
    } else {
        allData.forEach((item, index) => {
            let rankClass = '';
            if (index === 0) rankClass = 'rank-1';
            else if (index === 1) rankClass = 'rank-2';
            else if (index === 2) rankClass = 'rank-3';

            let ansClass = item.choice === 'True' ? 'ans-true' : 'ans-false';
            let dateObj = new Date(item.time);
            let timeStr = dateObj.toLocaleTimeString('th-TH') + '.' + Math.floor(dateObj.getMilliseconds() / 10).toString().padStart(2, '0');
            let isLatest = (index === allData.length - 1); 
            
            let row = `
                <tr class="${isLatest ? 'new-entry' : ''}">
                    <td><div class="rank-badge ${rankClass}">${index + 1}</div></td>
                    <td>
                        <div class="user-profile">
                            <img src="${item.img || 'https://via.placeholder.com/50'}" class="user-img">
                            <div>
                                <div class="user-name">${item.name}</div>
                                ${item.note ? `<span class="note-text">"${item.note}"</span>` : ''}
                            </div>
                        </div>
                    </td>
                    <td><span class="answer-tag ${ansClass}">${item.choice}</span></td>
                    <td><span class="time-stamp">⏱ ${timeStr} วินาที</span></td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // ฟังก์ชัน Reset แบบ Admin (ใช้รหัสผ่านเดียวกับหน้า Index)
    function clearData() {
        const password = prompt("กรุณาใส่รหัสผ่าน Admin เพื่อล้างข้อมูล:");
        // *** รหัสผ่านคือ admin1234 ***
        if (password === "admin1234") {
            if(confirm('ยืนยันการลบประวัติการส่งทั้งหมดหรือไม่?')) {
                localStorage.removeItem('eee434_responses');
                location.reload();
            }
        } else if (password !== null) {
            alert("รหัสผ่านไม่ถูกต้อง!");
        }
    }
</script>
